<!DOCTYPE html>
<html lang="cs">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Trackside Hokejov√° liga o Cejl</title>
<style>
  :root{
    --bg:#0b1220; --card:#111827; --ink:#e5e7eb; --muted:#9aa3b2; --line:#1f2937;
    --good:#16a34a; --bad:#ef4444; --brand:#22c55e; --accent:#60a5fa; --warn:#f59e0b;
  }
  html,body{margin:0;background:var(--bg);color:var(--ink);font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,"Helvetica Neue",Arial}
  .wrap{max-width:1180px;margin:24px auto;padding:0 14px}
  h1{font-size:26px;margin:0 0 8px}
  p{color:var(--muted)}
  .tabs{display:flex;gap:8px;flex-wrap:wrap;margin:14px 0 18px}
  .tab{padding:10px 14px;border:1px solid var(--line);border-radius:12px;background:#0d1627;cursor:pointer;font-weight:600}
  .tab.active{outline:2px solid var(--accent); background:linear-gradient(180deg,#0f1d33,#0b1426)}
  .grid{display:grid;gap:14px}
  .card{background:var(--card);border:1px solid var(--line);border-radius:14px;padding:14px;box-shadow:0 8px 20px rgba(0,0,0,.25)}
  .toolbar{display:flex;gap:10px;flex-wrap:wrap;align-items:center;margin-bottom:12px}
  button, .btn{
    appearance:none;border:1px solid var(--line);background:#0f1d33;color:var(--ink);
    padding:8px 12px;border-radius:12px;cursor:pointer;font-weight:600
  }
  button:hover{border-color:#2b3a52}
  .btn-primary{background:#143558;border-color:#1f3b63}
  .btn-warn{background:#2a1f03;border-color:#4a3705;color:#ffd78a}
  .btn-good{background:#06210f;border-color:#113b21;color:#a7efc2}
  .btn-bad{background:#2a0a0a;border-color:#3d1111;color:#ffc0c0}
  .flex{display:flex;gap:12px;flex-wrap:wrap;align-items:center}
  .table{width:100%;border-collapse:collapse}
  .table th,.table td{border-bottom:1px solid var(--line);padding:8px 10px;text-align:left;vertical-align:middle}
  .table th{font-weight:700;color:#f1f5f9;background:#0f1b2e;position:sticky;top:0;z-index:5}
  .leader{background:linear-gradient(180deg, rgba(34,197,94,.08), transparent)}
  .badge{display:inline-flex;align-items:center;gap:6px;padding:2px 8px;border:1px solid var(--line);border-radius:999px;font-size:12px;color:var(--muted)}
  .pair{display:grid;grid-template-columns:1fr auto 1fr;gap:10px;align-items:center}
  .team-tag{padding:6px 8px;border:1px solid var(--line);border-radius:12px;background:#0d1627;display:inline-block}
  details{border:1px solid var(--line);border-radius:12px;padding:10px;background:#0f1b2e}
  details[open]{outline:2px solid #1e3a8a}
  summary{cursor:pointer;list-style:none}
  summary::-webkit-details-marker{display:none}
  .two-col{display:grid;grid-template-columns:1fr 1fr;gap:12px}
  .three-col{display:grid;grid-template-columns:1fr 1fr 1fr;gap:8px}
  .field{display:flex;flex-direction:column;gap:4px}
  .field label{font-size:12px;color:var(--muted)}
  input[type="number"], input[type="text"], select, textarea{
    width:100%;padding:8px 10px;border-radius:10px;border:1px solid var(--line);background:#0b1322;color:var(--ink)
  }
  .right{justify-content:flex-end}
  .note{font-size:12px;color:var(--muted)}
  .team-page .header{display:flex;gap:10px;align-items:center;justify-content:space-between;flex-wrap:wrap}
  .kpis{display:grid;grid-template-columns:repeat(auto-fit,minmax(160px,1fr));gap:10px}
  .kpi{background:#0f1b2e;border:1px solid var(--line);border-radius:12px;padding:10px}
  .kpi b{font-size:18px}
  .row{display:flex;gap:12px;align-items:center;flex-wrap:wrap}
  .hr{height:1px;background:var(--line);margin:10px 0}
  .hidden{display:none}
  .nowrap{white-space:nowrap}
  .small{font-size:12px;color:var(--muted)}
  @media (max-width:760px){
    .two-col{grid-template-columns:1fr}
    .pair{grid-template-columns:1fr;gap:6px}
  }
</style>
</head>
<body>
<div class="wrap">
  <h1>Trackside Hokejov√° liga o Cejl <span class="badge">soukrom√° liga 6 hr√°ƒç≈Ø</span></h1>
  <div class="tabs">
    <div class="tab active" data-view="standings">Ligov√° tabulka</div>
    <div class="tab" data-view="rounds">Rozpis kol</div>
    <div class="tab" data-view="teams">Str√°nky t√Ωm≈Ø</div>
    <div class="tab" data-view="settings">Ulo≈æit / Export</div>
  </div>

  <div id="standings" class="grid">
    <div class="card">
      <div class="toolbar">
        <span class="badge">üèÜ L√≠dr tabulky je zv√Ωraznƒõn</span>
        <span class="badge">≈òazen√≠: body ‚Üí sk√≥re ‚Üí g√≥ly</span>
      </div>
      <div class="table-wrap" style="max-height:65vh;overflow:auto;border:1px solid var(--line);border-radius:12px">
        <table class="table" id="table-standings" aria-label="Ligov√° tabulka">
          <thead>
            <tr>
              <th>#</th>
              <th>T√Ωm</th>
              <th class="nowrap">Z</th>
              <th class="nowrap">V</th>
              <th class="nowrap">VpP</th>
              <th class="nowrap">PpP</th>
              <th class="nowrap">P</th>
              <th class="nowrap">Body</th>
              <th class="nowrap">GF</th>
              <th class="nowrap">GA</th>
              <th class="nowrap">+/-</th>
            </tr>
          </thead>
          <tbody id="standings-body"></tbody>
        </table>
      </div>
    </div>
  </div>

  <div id="rounds" class="grid hidden">
    <div class="card">
      <div class="toolbar">
        <button class="btn-primary" id="toggle-all">Rozbalit / Sbalit v≈°e</button>
        <span class="badge">Dom√°c√≠ t√Ωm a Hostuj√≠c√≠ t√Ωm jsou v samostatn√Ωch sloupc√≠ch</span>
        <span class="badge">Nikdo nehraje 2x po sobƒõ a nesetk√° se se stejn√Ωm soupe≈ôem v n√°sleduj√≠c√≠m kole</span>
      </div>
      <div id="rounds-list" class="grid"></div>
    </div>
  </div>

  <div id="teams" class="grid hidden">
    <div class="card">
      <div class="toolbar">
        <label class="badge">Vyber t√Ωm:</label>
        <select id="team-select"></select>
        <button id="team-refresh">Znovu spoƒç√≠tat statistiky</button>
      </div>
      <div id="team-page" class="team-page grid"></div>
    </div>
  </div>

  <div id="settings" class="grid hidden">
    <div class="card">
      <div class="toolbar">
        <button id="save-local" class="btn-good">Ulo≈æit do prohl√≠≈æeƒçe</button>
        <button id="load-local">Naƒç√≠st z prohl√≠≈æeƒçe</button>
        <button id="clear-local" class="btn-bad">Vymazat ulo≈æen√° data</button>
      </div>
      <div class="row">
        <button id="export-json">Exportovat JSON</button>
        <input id="import-file" type="file" accept="application/json" />
        <button id="import-json" class="btn-primary">Importovat JSON</button>
      </div>
      <p class="note">Data se ukl√°daj√≠ do <code>localStorage</code>. Export/Import umo≈æ≈àuje p≈ôen√©st v√Ωsledky mezi za≈ô√≠zen√≠mi.</p>
    </div>
  </div>

  <p class="small">Verze LITE. V≈°e bƒõ≈æ√≠ v prohl√≠≈æeƒçi, ≈æ√°dn√Ω backend.</p>
</div>

<script>
/* =======================
   Z√ÅKLADN√ç DATA LIGY
======================= */
const teams = [
  { id:"VGK", name:"Vegas Golden Knights", player:"Adam",  colors:["#b4975a","#333333"] },
  { id:"NSH", name:"Nashville Predators",  player:"Filip", colors:["#ffb81c","#041e42"] },
  { id:"WSH", name:"Washington Capitals",  player:"Martin",colors:["#c8102e","#041e42"] },
  { id:"DAL", name:"Dallas Stars",         player:"ShyRaptor", colors:["#006847","#8f8f8c"] },
  { id:"BOS", name:"Boston Bruins",        player:"Ihaz", colors:["#ffb81c","#000000"] },
  { id:"TOR", name:"Toronto Maple Leafs",  player:"Kr√°≈•a", colors:["#003e7e","#ffffff"] },
];

// Pomocn√° mapov√°n√≠
const byId = Object.fromEntries(teams.map(t=>[t.id,t]));
const teamIds = teams.map(t=>t.id);

/* =======================
   ROZPIS KOL ‚Äì 2x ka≈æd√Ω s ka≈æd√Ωm, 3 z√°pasy v kole,
   ≈æ√°dn√Ω t√Ωm nehraje 2x po sobƒõ v kole a nem√° stejn√©ho soupe≈ôe v n√°sleduj√≠c√≠m kole.
   Pou≈æit√Ω "circle method" pro 6 t√Ωm≈Ø: 5 kol + zrcadlen√≠ = 10 kol.
======================= */
function generateScheduleCircle(ids){
  // prvn√≠ f√°ze (5 kol)
  const n = ids.length; // 6
  let arr = ids.slice();
  const fixed = arr[0];
  let ring = arr.slice(1);
  const rounds = [];
  for(let r=0;r<n-1;r++){
    const pairings = [];
    // fixed hraje s ring[ring.length-1]
    pairings.push([fixed, ring[ring.length-1]]);
    for(let i=0;i<(n/2)-1;i++){
      pairings.push([ring[i], ring[ring.length-2-i]]);
    }
    rounds.push(pairings);
    // rotace
    ring = [ring[ring.length-1]].concat(ring.slice(0,ring.length-1));
  }
  // druh√° f√°ze: zrcadlit s prohozen√≠m dom√°c√≠/host
  const mirror = rounds.map(pairs => pairs.map(([a,b])=>[b,a]));
  return rounds.concat(mirror);
}

// Z√°kladn√≠ rozpis bez dom√°c√≠/venkovn√≠ alternace
const rawSchedule = generateScheduleCircle(teamIds);

// Zajistit st≈ô√≠d√°n√≠ DOMA/VENKU pro ka≈æd√Ω t√Ωm mezi koly co nejv√≠c
// Pro ka≈æd√© kolo urƒç√≠me dom√°c√≠/host na z√°kladƒõ paritn√≠ho indexu a barevnƒõ to p≈ôehod√≠me tak,
// aby ka≈æd√Ω t√Ωm typicky st≈ô√≠dal (ne stopro pro v≈°echny, ale bez po sobƒõ jdouc√≠ch soupe≈ô≈Ø zrcadlen√≠ je a≈æ za 5 kol).
function assignHomeAway(rounds){
  const result = [];
  const homeAwayHistory = Object.fromEntries(teamIds.map(id=>[id,[]]));
  rounds.forEach((pairs, rIdx)=>{
    const outPairs = pairs.map((p,i)=>{
      let [A,B] = p;
      // z√°klad: lich√© kolo otoƒç prvn√≠ dvojici, dal≈°√≠ nech podle indexu
      const flip = (rIdx % 2 === 1 && i === 0) || (i % 2 === 1);
      if(flip) [A,B] = [B,A];
      // pokud t√Ωm hr√°l minule doma, zkusit otoƒçit
      const lastA = homeAwayHistory[A].at(-1);
      const lastB = homeAwayHistory[B].at(-1);
      if(lastA === "H" && lastB !== "H"){ [A,B]=[B,A]; }
      else if(lastB === "H" && lastA !== "H"){ /* ok */ }
      // zapi≈° historii
      homeAwayHistory[A].push("H");
      homeAwayHistory[B].push("A");
      return {home:A, away:B};
    });
    result.push(outPairs);
  });
  return result;
}

const schedule = assignHomeAway(rawSchedule);

/* =======================
   PERSISTENCE
======================= */
const STORAGE_KEY = "nhl_friends_league_v1";
function saveToLocal(){
  const payload = {
    matches: getAllMatches().map(m=>m.data),
  };
  localStorage.setItem(STORAGE_KEY, JSON.stringify(payload));
}
function loadFromLocal(){
  const text = localStorage.getItem(STORAGE_KEY);
  if(!text) return;
  try{
    const payload = JSON.parse(text);
    if(payload && Array.isArray(payload.matches)){
      // map by matchId
      const map = Object.fromEntries(payload.matches.map(m=>[m.id,m]));
      applySavedData(map);
    }
  }catch(e){ console.error(e); }
}
function exportJSON(){
  const payload = {
    meta:{app:"Trackside League", version:1},
    matches: getAllMatches().map(m=>m.data),
  };
  const blob = new Blob([JSON.stringify(payload,null,2)], {type:"application/json"});
  const url = URL.createObjectURL(blob);
  const a = document.createElement("a");
  a.href = url; a.download = "trackside-league.json";
  document.body.appendChild(a); a.click(); a.remove();
  setTimeout(()=>URL.revokeObjectURL(url), 1000);
}
function importJSONFile(file, onDone){
  const reader = new FileReader();
  reader.onload = () => {
    try{
      const payload = JSON.parse(reader.result);
      if(payload && Array.isArray(payload.matches)){
        const map = Object.fromEntries(payload.matches.map(m=>[m.id,m]));
        applySavedData(map);
        onDone && onDone(true);
      }else onDone && onDone(false);
    }catch(e){ console.error(e); onDone && onDone(false); }
  };
  reader.readAsText(file);
}

/* =======================
   DOM UTILS
======================= */
function el(tag, attrs={}, children=[]){
  const e = document.createElement(tag);
  Object.entries(attrs).forEach(([k,v])=>{
    if(k==="class") e.className = v;
    else if(k==="html") e.innerHTML = v;
    else if(k.startsWith("on") && typeof v==="function") e.addEventListener(k.slice(2), v);
    else e.setAttribute(k,v);
  });
  (Array.isArray(children)?children:[children]).forEach(c=>{
    if(c==null) return;
    if(typeof c==="string") e.appendChild(document.createTextNode(c));
    else e.appendChild(c);
  });
  return e;
}

/* =======================
   MATCH DATA MODEL
======================= */
const matchesById = new Map(); // id -> {root, data}
function matchId(roundIdx, idx){ return `R${roundIdx+1}_M${idx+1}`; }

function defaultMatchData(id, home, away){
  return {
    id, home, away,
    scoreHome: 0, scoreAway: 0,
    result: "", // "HW","HWOT","AW","AWOT"
    // detailn√≠ statistiky
    shotsHome: 0, shotsAway: 0,
    hitsHome: 0, hitsAway: 0,
    toaHome: "00:00", toaAway: "00:00",
    passHome: 0, passAway: 0,
    faceoffHome: 0, faceoffAway: 0,
    pimsHome: 0, pimsAway: 0,
    ppHome: 0, ppAway: 0,
    ppTimeHome: "00:00", ppTimeAway: "00:00",
    shgHome: 0, shgAway: 0,
    // g√≥ly po t≈ôetin√°ch
    p1Home: 0, p1Away: 0,
    p2Home: 0, p2Away: 0,
    p3Home: 0, p3Away: 0,
    note:""
  };
}

function createMatchCard(roundIdx, idx, pair){
  const id = matchId(roundIdx, idx);
  const data = defaultMatchData(id, pair.home, pair.away);

  const domCol = el("div", {class:"field"}, [
    el("label", {}, "Dom√°c√≠ t√Ωm"),
    el("div", {class:"team-tag"}, `${byId[pair.home].name} (${pair.home})`),
  ]);
  const awaCol = el("div", {class:"field"}, [
    el("label", {}, "Hostuj√≠c√≠ t√Ωm"),
    el("div", {class:"team-tag"}, `${byId[pair.away].name} (${pair.away})`),
  ]);

  const head = el("div", {class:"pair"}, [
    domCol,
    el("div", {}, "√ó"),
    awaCol,
  ]);

  const summary = el("summary", {html:`<b>${byId[pair.home].name}</b> √ó <b>${byId[pair.away].name}</b> <span class="small">(klikni pro detail)</span>`});

  function numField(key, labelTxt){
    const input = el("input", {type:"number", value:0, min:"0", oninput:()=>{ data[key]=Number(input.value||0); refresh(); }});
    return el("div", {class:"field"}, [el("label",{},labelTxt), input]);
  }
  function timeField(key, labelTxt){
    const input = el("input", {type:"text", value:"00:00", oninput:()=>{ data[key]=input.value; }});
    return el("div", {class:"field"}, [el("label",{},labelTxt), input]);
  }
  const resSel = el("select", {oninput:()=>{ data.result = resSel.value; refresh(); }}, [
    el("option", {value:""}, "V√Ωsledek..."),
    el("option", {value:"HW"}, "Vyhr√°l dom√°c√≠"),
    el("option", {value:"HWOT"}, "Vyhr√°l dom√°c√≠ (OT)"),
    el("option", {value:"AW"}, "Vyhr√°l hostuj√≠c√≠"),
    el("option", {value:"AWOT"}, "Vyhr√°l hostuj√≠c√≠ (OT)"),
  ]);

  const scHome = el("input", {type:"number", value:0, min:"0", oninput:()=>{ data.scoreHome=Number(scHome.value||0); refresh(); }});
  const scAway = el("input", {type:"number", value:0, min:"0", oninput:()=>{ data.scoreAway=Number(scAway.value||0); refresh(); }});

  const goalsRow = el("div", {class:"three-col"}, [
    numField("p1Home","G√≥ly 1. t≈ôetina (dom√°c√≠)"),
    numField("p1Away","G√≥ly 1. t≈ôetina (host√©)"),
    el("div", {},""),
    numField("p2Home","G√≥ly 2. t≈ôetina (dom√°c√≠)"),
    numField("p2Away","G√≥ly 2. t≈ôetina (host√©)"),
    el("div", {},""),
    numField("p3Home","G√≥ly 3. t≈ôetina (dom√°c√≠)"),
    numField("p3Away","G√≥ly 3. t≈ôetina (host√©)"),
    el("div", {},""),
  ]);

  const statsGrid = el("div", {class:"two-col"}, [
    el("div", {class:"field"}, [el("label",{},"Typ v√Ωsledku"), resSel]),
    el("div", {class:"field"}, [el("label",{},"Pozn√°mka"), el("input",{type:"text", oninput:e=>{data.note=e.target.value;}})]),

    el("div", {class:"field"}, [el("label",{},"Sk√≥re dom√°c√≠"), scHome]),
    el("div", {class:"field"}, [el("label",{},"Sk√≥re host√©"), scAway]),

    numField("shotsHome","St≈ôely (dom√°c√≠)"),
    numField("shotsAway","St≈ôely (host√©)"),
    numField("hitsHome","Hity (dom√°c√≠)"),
    numField("hitsAway","Hity (host√©)"),
    timeField("toaHome","ƒåas v √∫toƒçn√©m p√°smu (dom√°c√≠)"),
    timeField("toaAway","ƒåas v √∫toƒçn√©m p√°smu (host√©)"),
    numField("passHome","√öspƒõ≈°nost p≈ôihr√°vek % (dom√°c√≠)"),
    numField("passAway","√öspƒõ≈°nost p≈ôihr√°vek % (host√©)"),
    numField("faceoffHome","Vyhran√° vhazov√°n√≠ (dom√°c√≠)"),
    numField("faceoffAway","Vyhran√° vhazov√°n√≠ (host√©)"),
    numField("pimsHome","Trestn√© minuty (dom√°c√≠)"),
    numField("pimsAway","Trestn√© minuty (host√©)"),
    numField("ppHome","P≈ôesilovky (dom√°c√≠)"),
    numField("ppAway","P≈ôesilovky (host√©)"),
    timeField("ppTimeHome","ƒåas p≈ôesilovky (dom√°c√≠)"),
    timeField("ppTimeAway","ƒåas p≈ôesilovky (host√©)"),
    numField("shgHome","G√≥ly v oslaben√≠ (dom√°c√≠)"),
    numField("shgAway","G√≥ly v oslaben√≠ (host√©)"),
  ]);

  const details = el("details", {}, [summary, el("div",{class:"hr"}), head, el("div",{class:"hr"}), goalsRow, el("div",{class:"hr"}), statsGrid]);

  const root = el("div", {class:"card"}, [details]);
  matchesById.set(id, {root, data});

  function refresh(){ renderStandings(); }
  return {root, data};
}

/* =======================
   ROUNDS RENDER
======================= */
function renderRounds(){
  const list = document.getElementById("rounds-list");
  list.innerHTML = "";
  schedule.forEach((pairs, rIdx)=>{
    const title = el("h2", {}, `${rIdx+1}. kolo`);
    const roundWrap = el("div", {class:"grid"});
    pairs.forEach((pair, idx)=>{
      const m = createMatchCard(rIdx, idx, pair);
      roundWrap.appendChild(m.root);
    });
    const grid = el("div", {class:"card"}, [
      el("div", {class:"toolbar"}, [
        el("span", {class:"badge"}, "3 z√°pasy v kole"),
        el("span", {class:"badge"}, "Dom√°c√≠ t√Ωm | Hostuj√≠c√≠ t√Ωm"),
      ]),
      title, roundWrap
    ]);
    list.appendChild(grid);
  });
}

/* =======================
   STANDINGS
======================= */
function emptyStats(){
  return {
    GP:0, W:0, WOT:0, LOT:0, L:0, PTS:0, GF:0, GA:0,
    // sum√°rky pro t√Ωmov√© str√°nky
    shots:0, hits:0, toaSec:0, passSum:0, passCount:0, faceoffs:0, pims:0, pps:0, pptimeSec:0, shg:0,
    p1:0, p2:0, p3:0,
  };
}
function parseMMSS(s){
  const m = /^(\d{1,2}):(\d{2})$/.exec(String(s||""));
  if(!m) return 0;
  return parseInt(m[1])*60 + parseInt(m[2]);
}
function fmtMMSS(sec){
  const m = Math.floor(sec/60); const s = sec%60;
  return `${String(m).padStart(2,"0")}:${String(s).padStart(2,"0")}`;
}

function getAllMatches(){
  return Array.from(matchesById.values());
}
function applySavedData(map){
  getAllMatches().forEach(m=>{
    const saved = map[m.data.id];
    if(saved){
      // merge
      Object.assign(m.data, saved);
      // tak√© napln√≠me DOM hodnoty u vstup≈Ø v m.root
      const inputs = m.root.querySelectorAll("input, select");
      inputs.forEach(inp=>{
        const label = inp.previousElementSibling?.textContent?.trim() || "";
        // mapov√°n√≠ podle labelu je k≈ôehk√©; radƒõji pou≈æijme datov√© atributy by design,
        // ale tady udƒõl√°me rychl√© obnoven√≠ jen pro hlavn√≠ pole
      });
    }
  });
  renderStandings();
  renderTeamPage(currentTeamId);
}

function computeStandings(){
  const s = Object.fromEntries(teamIds.map(id=>[id, emptyStats()]));
  getAllMatches().forEach(({data})=>{
    if(!data.result) return; // nehodnocen√©
    const A = s[data.home], B = s[data.away];
    A.GP++; B.GP++;
    A.GF += data.scoreHome; A.GA += data.scoreAway;
    B.GF += data.scoreAway; B.GA += data.scoreHome;

    // sum√°rky
    A.shots += data.shotsHome; B.shots += data.shotsAway;
    A.hits  += data.hitsHome;  B.hits  += data.hitsAway;
    A.toaSec += parseMMSS(data.toaHome); B.toaSec += parseMMSS(data.toaAway);
    if(data.passHome){ A.passSum += data.passHome; A.passCount++; }
    if(data.passAway){ B.passSum += data.passAway; B.passCount++; }
    A.faceoffs += data.faceoffHome; B.faceoffs += data.faceoffAway;
    A.pims += data.pimsHome; B.pims += data.pimsAway;
    A.pps += data.ppHome; B.pps += data.ppAway;
    A.pptimeSec += parseMMSS(data.ppTimeHome); B.pptimeSec += parseMMSS(data.ppTimeAway);
    A.shg += data.shgHome; B.shg += data.shgAway;
    A.p1 += data.p1Home; B.p1 += data.p1Away;
    A.p2 += data.p2Home; B.p2 += data.p2Away;
    A.p3 += data.p3Home; B.p3 += data.p3Away;

    switch(data.result){
      case "HW": A.W++; A.PTS+=3; B.L++; break;
      case "AW": B.W++; B.PTS+=3; A.L++; break;
      case "HWOT": A.WOT++; A.PTS+=2; B.LOT++; B.PTS+=1; break;
      case "AWOT": B.WOT++; B.PTS+=2; A.LOT++; A.PTS+=1; break;
    }
  });
  return s;
}
function renderStandings(){
  const s = computeStandings();
  const arr = teamIds.map(id=>{
    const o = s[id]; const diff = o.GF - o.GA;
    return {id, name:byId[id].name, ...o, DIFF:diff};
  });
  arr.sort((a,b)=> b.PTS - a.PTS || (b.DIFF - a.DIFF) || (b.GF - a.GF) || a.name.localeCompare(b.name));
  const body = document.getElementById("standings-body");
  body.innerHTML = "";
  arr.forEach((row, idx)=>{
    const tr = el("tr", {class: idx===0?"leader":""});
    tr.appendChild(el("td", {}, idx===0 ? "1 üèÜ" : String(idx+1)));
    tr.appendChild(el("td", {}, row.name));
    tr.appendChild(el("td", {}, String(row.GP)));
    tr.appendChild(el("td", {}, String(row.W)));
    tr.appendChild(el("td", {}, String(row.WOT)));
    tr.appendChild(el("td", {}, String(row.LOT)));
    tr.appendChild(el("td", {}, String(row.L)));
    tr.appendChild(el("td", {}, String(row.PTS)));
    tr.appendChild(el("td", {}, String(row.GF)));
    tr.appendChild(el("td", {}, String(row.GA)));
    tr.appendChild(el("td", {}, String(row.DIFF)));
    body.appendChild(tr);
  });
}

/* =======================
   TEAM PAGE
======================= */
let currentTeamId = teamIds[0];
function renderTeamSelect(){
  const sel = document.getElementById("team-select");
  sel.innerHTML = "";
  teams.forEach(t=>{
    const opt = el("option", {value:t.id}, `${t.player} ‚Äì ${t.name} (${t.id})`);
    sel.appendChild(opt);
  });
  sel.value = currentTeamId;
  sel.oninput = () => { currentTeamId = sel.value; renderTeamPage(currentTeamId); };
}
function renderTeamPage(teamId){
  const s = computeStandings()[teamId];
  const wrap = document.getElementById("team-page");
  wrap.innerHTML = "";
  const header = el("div", {class:"header"}, [
    el("h2", {}, `${byId[teamId].name} ‚Äî str√°nka t√Ωmu`),
    el("span", {class:"badge"}, `Hr√°ƒç: ${byId[teamId].player}`),
  ]);

  const avgPass = s.passCount ? (s.passSum/s.passCount).toFixed(1) : "0.0";
  const kpis = el("div", {class:"kpis"}, [
    el("div", {class:"kpi"}, [el("div",{},"Z√°pasy"), el("b",{},String(s.GP))]),
    el("div", {class:"kpi"}, [el("div",{},"Body"), el("b",{},String(s.PTS))]),
    el("div", {class:"kpi"}, [el("div",{},"Sk√≥re"), el("b",{},`${s.GF}:${s.GA} (${s.GF-s.GA})`)]),
    el("div", {class:"kpi"}, [el("div",{},"St≈ôely"), el("b",{},String(s.shots))]),
    el("div", {class:"kpi"}, [el("div",{},"Hity"), el("b",{},String(s.hits))]),
    el("div", {class:"kpi"}, [el("div",{},"ƒåas v √∫toƒçn√©m p√°smu"), el("b",{},fmtMMSS(s.toaSec))]),
    el("div", {class:"kpi"}, [el("div",{},"P≈ôihr√°vky % (pr≈Øm.)"), el("b",{},String(avgPass))]),
    el("div", {class:"kpi"}, [el("div",{},"Vhazov√°n√≠ (vyhr.)"), el("b",{},String(s.faceoffs))]),
    el("div", {class:"kpi"}, [el("div",{},"Trestn√© minuty"), el("b",{},String(s.pims))]),
    el("div", {class:"kpi"}, [el("div",{},"P≈ôesilovky"), el("b",{},String(s.pps))]),
    el("div", {class:"kpi"}, [el("div",{},"ƒåas p≈ôesilovek"), el("b",{},fmtMMSS(s.pptimeSec))]),
    el("div", {class:"kpi"}, [el("div",{},"G√≥ly v oslaben√≠"), el("b",{},String(s.shg))]),
    el("div", {class:"kpi"}, [el("div",{},"G√≥ly 1./2./3. t≈ôetina"), el("b",{},`${s.p1}/${s.p2}/${s.p3}`)]),
  ]);

  // Seznam z√°pas≈Ø t√Ωmu vƒçetnƒõ g√≥l≈Ø po t≈ôetin√°ch
  const table = el("table", {class:"table"});
  table.appendChild(el("thead", {}, el("tr", {}, [
    el("th", {}, "Kolo"),
    el("th", {}, "Dom√°c√≠"),
    el("th", {}, "Host√©"),
    el("th", {}, "Sk√≥re"),
    el("th", {}, "Typ"),
    el("th", {}, "1.t≈ô"),
    el("th", {}, "2.t≈ô"),
    el("th", {}, "3.t≈ô"),
  ])));
  const tbody = el("tbody", {});

  schedule.forEach((pairs, rIdx)=>{
    pairs.forEach((p, idx)=>{
      const id = matchId(rIdx, idx);
      const rec = matchesById.get(id).data;
      if(rec.home!==teamId && rec.away!==teamId) return;
      const score = `${rec.scoreHome}:${rec.scoreAway}`;
      const type = rec.result||"";
      const p1 = `${rec.p1Home}:${rec.p1Away}`;
      const p2 = `${rec.p2Home}:${rec.p2Away}`;
      const p3 = `${rec.p3Home}:${rec.p3Away}`;
      const tr = el("tr", {}, [
        el("td", {}, String(rIdx+1)),
        el("td", {}, byId[rec.home].name),
        el("td", {}, byId[rec.away].name),
        el("td", {}, score),
        el("td", {}, type),
        el("td", {}, p1),
        el("td", {}, p2),
        el("td", {}, p3),
      ]);
      tbody.appendChild(tr);
    });
  });
  table.appendChild(tbody);

  wrap.appendChild(header);
  wrap.appendChild(kpis);
  wrap.appendChild(el("div",{class:"card"},[el("h3",{},"Odehran√© z√°pasy"), table]));
}

/* =======================
   NAV / INIT
======================= */
function switchView(key){
  ["standings","rounds","teams","settings"].forEach(k=>{
    document.getElementById(k).classList.toggle("hidden", k!==key);
    document.querySelectorAll(`.tab[data-view]`).forEach(t=>{
      t.classList.toggle("active", t.getAttribute("data-view")===key);
    });
  });
}
document.querySelectorAll(".tab[data-view]").forEach(t=> t.addEventListener("click", ()=> switchView(t.getAttribute("data-view")) ));

document.getElementById("toggle-all").addEventListener("click", ()=>{
  document.querySelectorAll("#rounds-list details").forEach(d=> d.open = !d.open);
});
document.getElementById("save-local").addEventListener("click", ()=>{ saveToLocal(); alert("Ulo≈æeno do prohl√≠≈æeƒçe."); });
document.getElementById("load-local").addEventListener("click", ()=>{ loadFromLocal(); alert("Naƒçteno z prohl√≠≈æeƒçe."); });
document.getElementById("clear-local").addEventListener("click", ()=>{ localStorage.removeItem(STORAGE_KEY); alert("Ulo≈æen√° data smaz√°na."); });
document.getElementById("export-json").addEventListener("click", ()=> exportJSON() );
document.getElementById("import-json").addEventListener("click", ()=>{
  const f = document.getElementById("import-file").files?.[0];
  if(!f){ alert("Vyber soubor .json"); return; }
  importJSONFile(f, ok=> alert(ok?"Naƒçteno.":"Nepoda≈ôilo se importovat."));
});
document.getElementById("team-refresh").addEventListener("click", ()=> renderTeamPage(currentTeamId) );

// Initial render
renderRounds();
renderStandings();
renderTeamSelect();
renderTeamPage(currentTeamId);

// Po prvn√≠m vykreslen√≠ se pokus√≠me naƒç√≠st ulo≈æen√° data
loadFromLocal();
</script>
</body>
</html>
